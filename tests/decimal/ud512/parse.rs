use std::str::FromStr;

use rstest::*;

use fastnum::{u512, U512, UD512};

use crate::decimal::common::parse::{test_impl, test_impl_unsigned};

test_impl!(u512, U512, UD512);
test_impl_unsigned!(u512, U256, UD512);

#[rstest(::trace)]
#[case("340282366920938463463374607431768211455", u512!(340282366920938463463374607431768211455), 0)]
#[case("34028236692093846346337460743176821145.5", u512!(340282366920938463463374607431768211455), -1)]
#[case("34028236692093846346337460743176821145.5e1000", u512!(340282366920938463463374607431768211455), 999)]
#[case("340282366920938463.463374607431768211455e-1000", u512!(340282366920938463463374607431768211455), -1021)]
#[case("115792089237316195423570985008687907853269984665640564039457584007913129639935", u512!(115792089237316195423570985008687907853269984665640564039457584007913129639935), 0)]
#[case("1157920892373161954235709850086.87907853269984665640564039457584007913129639935", u512!(115792089237316195423570985008687907853269984665640564039457584007913129639935), -47)]
#[case("13407807929942597099574024998205846127479365820592393377723561443721764030073546976801874298166903427690031858186486050853753882811946569946433649006084095", u512!(13407807929942597099574024998205846127479365820592393377723561443721764030073546976801874298166903427690031858186486050853753882811946569946433649006084095), 0)]
#[case("1340780792994259709957402499820584612747936582.0592393377723561443721764030073546976801874298166903427690031858186486050853753882811946569946433649006084095", u512!(13407807929942597099574024998205846127479365820592393377723561443721764030073546976801874298166903427690031858186486050853753882811946569946433649006084095), -109)]
fn test_parse_ok_512(#[case] s: &str, #[case] _int: U512, #[case] exp: i64) {
    let dec = UD512::from_str(s).unwrap();
    assert_eq!(dec.significant_digits(), _int);
    assert_eq!(dec.fractional_digit_count(), -exp);
}

#[rstest(::trace)]
#[case("13407807929942597099574024998205846127479365820592393377723561443721764030073546976801874298166903427690031858186486050853753882811946569946433649006084096")]
#[case("13407807929942597099574024998205846127479365820592393377723561443721764030073546976801874298166903427690031858186486050853753882811946569946433649006084095.1")]
#[should_panic(expected = "(fastnum) number too large to fit in target type")]
fn test_parse_overflow_512(#[case] s: &str) {
    let _ = UD512::from_str(s).unwrap();
}
